# 全自动氛围神器 (Auto-Atmosphere-Tool)

这是一个基于 Selenium 和 Python 的全自动 Bilibili 互动工具。它能够模拟用户行为进行自动评论和点赞，旨在帮助用户管理和维护 Bilibili 账号的活跃度。

## 📁 目录结构说明

本项目采用模块化设计，各目录职责如下：

*   **`config/` (配置管理)**
    *   `accounts.json`: 存储用户添加的 Bilibili 账号信息。
    *   `config_handler.py`: 负责读取和写入配置文件。
    *   `cookies.json`: (可选) 存储账号的 Cookie 信息。

*   **`core/` (核心逻辑)**
    *   `platform_manager.py`: **平台实例管理器**。实现了单例模式，确保每个账号在同一时间只有一个浏览器实例运行，防止资源冲突。提供了 `quit_all` 方法用于强制清理所有浏览器进程。
    *   `comment_send.py`: **评论核心逻辑**。负责调度平台的发送评论功能。
    *   `like_core.py`: **点赞核心逻辑**。负责调度平台的点赞功能，支持高精度（0.1秒级）间隔控制。
    *   `account_manager.py`: 账号增删改查的管理逻辑。
    *   `risk_control.py`: **风控模块**。负责生成随机间隔、监控操作频率阈值，防止账号因操作过快被平台封控。

*   **`platforms/` (平台实现)**
    *   `base_platform.py`: 定义了平台必须实现的基类接口（如 `login`, `send_comment`, `like`）。
    *   `bilibili.py`: **Bilibili 平台实现**。使用 API 进行高效评论和点赞。

*   **`ui/` (用户界面)**
    *   `main_window.py`: **主窗口**。程序的 GUI 入口，启动时自动最大化 (1400x900)，并实现了窗口关闭时的强制进程清理逻辑。
    *   `setting_panel.py`: 设置面板，用于配置评论/点赞的间隔时长（支持小数）、目标数量等。
    *   `account_dialog.py`: 添加/编辑账号的弹窗。
    *   `status_display.py`: 实时显示运行日志和状态的组件。
    *   `guide.py`: **新手引导**。首次启动时显示的引导教程。

*   **`utils/` (工具库)**
    *   `driver_helper.py`: **浏览器驱动核心**。负责自动化下载/管理 Edge 驱动、配置反爬虫策略（Stealth）、清理僵尸进程。
    *   `logger.py`: 全局日志配置。
    *   `ua_pool.py`: 随机 User-Agent 池。
    *   `cookie_handler.py`: Cookie 处理工具。

*   **`userdata/` (用户数据)**
    *   此目录非常重要，存储了所有账号的浏览器 **User Data**（包括登录状态、Cookie、缓存）。**请勿删除此目录**，否则所有账号需要重新登录。

*   **根目录**
    *   `main.py`: **程序启动入口**。
    *   `requirements.txt`: 项目依赖列表。

---

## 🚀 运行机制

1.  **启动与初始化**:
    *   运行 `main.py` 启动 GUI 界面，窗口会自动调整为最佳分辨率并最大化。
    *   程序自动检测并初始化 Edge 浏览器驱动（优先使用本地，失败则自动下载）。

2.  **账号管理**:
    *   用户在界面添加 Bilibili 账号，程序会在 `userdata/` 下为每个账号创建独立的浏览器配置文件，实现**多账号隔离**和**免登录保持**。
    *   首次使用需点击“打开网页”手动登录，登录状态会被持久化保存。

3.  **任务执行**:
    *   **评论/点赞**: 用户设置目标直播间/视频 URL 和评论内容。
    *   **高精度控制**: 支持 **0.1秒级** 的操作间隔设置（如固定 0.1秒 或 随机 0.1-0.5秒），满足高频互动需求。
    *   **多线程并发**: 点击“开始”后，程序会根据选定的账号启动多线程任务。
    *   **平台适配**:
        *   **Bilibili**: 主要通过 API 接口进行交互，速度快且稳定。
        *   **防检测**: 使用 `selenium-stealth` 和自定义 Edge 选项（如禁用 WebGL 识别、自动化特征隐藏）来规避平台检测。

4.  **资源管理与安全退出**:
    *   `PlatformInstanceManager` 确保每个账号的浏览器实例是唯一的。
    *   **强制清理**: 程序关闭时会触发 `_on_closing` 事件，强制终止所有业务线程，关闭所有浏览器实例，并杀死残留的 `msedge.exe` 进程，彻底解决后台残留问题。

---

## � 详细使用教程

### 1. 启动程序
*   确保已安装所有依赖（见下文“安装依赖”）。
*   在项目根目录下运行 `python main.py`。
*   程序启动后会自动最大化窗口，并显示主界面。

### 2. 添加与管理账号
1.  **添加账号**:
    *   点击界面顶部的 **“添加账号”** 按钮。
    *   在弹出的对话框中输入 **账号名称**（用于本地标识，可随意填写）。
    *   点击 **“打开网页”**，程序将启动一个独立的浏览器窗口。
    *   在该浏览器中手动登录 Bilibili 账号（支持扫码、密码登录）。
    *   登录成功后关闭浏览器窗口，返回弹窗点击 **“确定”**。
2.  **切换账号**:
    *   在顶部 **“选择账号”** 下拉框中选择已添加的账号。
    *   点击 **“刷新账号”** 可更新列表。
3.  **删除账号**:
    *   选中要删除的账号，点击 **“删除账号”** 按钮，确认后将清除该账号的所有本地数据。

### 3. 配置任务参数
界面分为左右两个主要配置区：

#### 左侧：评论/弹幕配置
*   **目标URL**: 输入 Bilibili 直播间或视频的完整链接（如 `https://live.bilibili.com/xxx` 或 `https://www.bilibili.com/video/BVxxx`）。
*   **评论内容**:
    *   **自定义评论**: 在文本框中直接输入，每行一条。
    *   **导入文件**: 点击“选择文件”导入 `.txt` 或 Excel 文件（每行一条评论）。
*   **发送模式**:
    *   **顺序发送**: 按列表顺序循环发送。
    *   **随机发送**: 随机从列表中选取内容发送。
*   **发送间隔**:
    *   **固定间隔**: 设置固定的秒数（支持小数，如 `0.5`）。
    *   **随机间隔**: 设置最小值和最大值（如 `2` - `5` 秒）。
*   **启用评论发送**: 勾选开启。

#### 右侧：点赞配置
*   **点赞间隔**:
    *   支持 **高精度控制**。例如设置固定间隔 `0.1` 秒，或随机间隔 `0.1` - `0.3` 秒，以实现极速点赞。
*   **期望点赞数量**: 设置该账号本次任务的目标点赞次数（达到后自动停止该账号的点赞）。
*   **启用自动点赞**: 勾选开启。

### 4. 运行与监控
*   **运行时长**: 在评论配置区底部设置任务的 **总运行时长**（单位：分钟）。
*   **开始任务**: 点击底部的 **“开始运行”** 按钮。
    *   程序将自动根据配置启动浏览器（后台运行，不干扰前台）。
    *   底部状态栏会显示当前进度条和剩余时间。
*   **暂停/继续**: 点击 **“暂停”** 可暂时挂起任务，再次点击继续。
*   **停止**: 点击 **“停止”** 将结束当前任务并清理资源。

### 5. 安全退出
*   点击窗口右上角的关闭按钮 (X)。
*   程序会弹出确认提示，点击“确定”后将自动执行 **深度清理**：
    *   停止所有正在运行的自动任务。
    *   关闭所有后台浏览器实例。
    *   强制结束残留进程，确保系统干净。

---

## �📦 项目依赖

本项目依赖 Python 3.8+ 环境。主要依赖库如下：

*   **核心自动化**:
    *   `selenium`: 浏览器自动化控制。
    *   `webdriver-manager`: 自动下载和管理浏览器驱动。
    *   `selenium-stealth`: 隐藏 Selenium 特征，防止被网站识别为机器人。

*   **网络与请求**:
    *   `requests`: 发送 HTTP 请求（用于 API 交互）。
    *   `fake-useragent`: 生成随机 User-Agent。

*   **图形界面 (GUI)**:
    *   `ttkbootstrap`: 基于 Tkinter 的美化主题库。
    *   `tkinterdnd2`: 支持文件拖放功能。

*   **系统与工具**:
    *   `psutil`: (推荐安装) 用于查找和杀死僵尸浏览器进程。
    *   `pyperclip`: 剪贴板操作。

### 安装依赖

请在项目根目录下运行以下命令安装所有依赖：

```bash
pip install -r requirements.txt
pip install psutil
```
